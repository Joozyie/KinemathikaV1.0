@* WHAT IT DOES:
   - “All / Archived” view of classes using card tiles.
   - Title (class name) is the only link to open the class dashboard.
   - Kebab in the card header keeps its actions (Edit / Archive or Restore).
   - Footer now has quick links: **Stats** (Reports tab) and **People** (Students tab).
*@
@model Kinemathika.ViewModels.Teacher.TeacherClassesVm
@{
    ViewData["IsAuthPage"] = true;
    ViewData["Title"] = Model.Archived ? "Archived Classes" : "All Classes";
    Layout = "~/Views/Shared/_TeacherLayout.cshtml";
}

@section PageTitle {
    <div class="fw-semibold">@ViewData["Title"]</div>
}
@section PageActions {
    @if (!Model.Archived)
    {
        <a class="btn btn-success btn-sm" asp-action="Create">New Class</a>
    }
}

<div class="card border-0 shadow-sm rounded-4">
    <div class="card-body">
        <div class="d-flex gap-2 mb-3 align-items-center">
            <a class="btn btn-light @(Model.Archived ? "" : "active")" asp-action="Classes">All</a>
            <a class="btn btn-light @(Model.Archived ? "active" : "")" asp-action="Classes" asp-route-archived="true">Archived</a>
            <div class="ms-auto"></div>
        </div>

        @if (!Model.Classes.Any())
        {
            <div class="alert alert-info mb-0">No classes to show.</div>
        }
        else
        {
            <div class="row g-4">
                @foreach (var c in Model.Classes)
                {
                    <div class="col-12 col-sm-6 col-xl-4">
                        <div class="km-class-card h-100 d-flex flex-column" style="--km-head:#187C19;">
                            <!-- Header (colored) -->
                            <div class="km-class-head d-flex align-items-start">
                                <div class="km-class-title text-truncate">
                                    <!-- Only the NAME opens the class -->
                                    <a class="class-title-link text-white text-decoration-none fw-semibold"
                                       href="@Url.Action("Dashboard", "Teacher", new { classId = c.Id })">
                                        @c.Name
                                    </a>
                                    <div class="small text-white-50">@c.StudentCount student(s)</div>
                                </div>

                                <!-- Kebab (actions) -->
                                <div class="dropdown ms-auto">
                                    <button class="kebab-btn text-white" type="button" data-bs-toggle="dropdown" aria-expanded="false"
                                            title="Class actions">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        @if (!Model.Archived)
                                        {
                                            <li>
                                                <button class="dropdown-item"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#classSettingsModal"
                                                        data-class-id="@c.Id"
                                                        data-class-name="@c.Name">
                                                    Edit
                                                </button>
                                            </li>
                                            <li>
                                                <button class="dropdown-item text-danger"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#classArchiveModal"
                                                        data-class-id="@c.Id"
                                                        data-class-name="@c.Name">
                                                    Archive
                                                </button>
                                            </li>
                                        }
                                        else
                                        {
                                            <li>
                                                <form asp-action="Unarchive" method="post" class="px-3 py-1">
                                                    @Html.AntiForgeryToken()
                                                    <input type="hidden" name="id" value="@c.Id" />
                                                    <button class="btn btn-link p-0">Restore</button>
                                                </form>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>

                            <!-- Body (blank like G Classroom) -->
                            <div class="km-class-body flex-grow-1"></div>

                            <!-- Footer: quick links -->
                            <div class="km-class-foot d-flex justify-content-around align-items-center">
                                <a class="link-secondary small text-decoration-none d-inline-flex align-items-center gap-1"
                                   href="@Url.Action("Dashboard", "Teacher", new { classId = c.Id })#tab-reports"
                                   title="Go to Reports">
                                    <i class="bi bi-graph-up"></i><span>Stats</span>
                                </a>
                                <a class="link-secondary small text-decoration-none d-inline-flex align-items-center gap-1"
                                   href="@Url.Action("Dashboard", "Teacher", new { classId = c.Id })#tab-students"
                                   title="Go to Students">
                                    <i class="bi bi-people"></i><span>People</span>
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

<!-- Shared modals (Edit / Archive / Restore) -->
<partial name="~/Views/Shared/_ClassManagementModals.cshtml" />
